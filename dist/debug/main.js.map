{"version":3,"sources":["../../scripts/main.ts","../../scripts/PortalGun.ts","../../node_modules/@minecraft/math/src/general/clamp.ts","../../node_modules/@minecraft/math/src/vector3/coreHelpers.ts","../../scripts/utils.ts"],"sourcesContent":["import { Player, system, world, EntityInventoryComponent } from \"@minecraft/server\";\r\nimport { Guns } from \"./PortalGun\";\r\nimport { teleportToLinkedPortal } from \"./utils\";\r\n\r\nsystem.runInterval(() => {\r\n  world.getAllPlayers().forEach((player) => {\r\n    const defaultGun = (player.getDynamicProperty(`defaultGun`) as string) || `red`;\r\n\r\n    const inventory = player.getComponent(\"minecraft:inventory\") as EntityInventoryComponent;\r\n    const selectedSlot = player.selectedSlotIndex;\r\n    const handItem = inventory?.container?.getItem(selectedSlot);\r\n\r\n    if (handItem?.typeId === \"keyyard:portal_gun\") {\r\n      switch (defaultGun) {\r\n        case \"red\":\r\n          player.onScreenDisplay.setActionBar(`Current Portal Mode §c§l[Red]`);\r\n          break;\r\n        case \"blue\":\r\n          player.onScreenDisplay.setActionBar(`Current Portal Mode §b§l[Blue]`);\r\n          break;\r\n      }\r\n    }\r\n  });\r\n});\r\n\r\nworld.afterEvents.itemUse.subscribe(({ itemStack, source }) => {\r\n  if (!(source instanceof Player)) {\r\n    return;\r\n  }\r\n\r\n  let defaultGun = source.getDynamicProperty(`defaultGun`) as string;\r\n  if (!defaultGun) {\r\n    source.setDynamicProperty(`defaultGun`, `red`);\r\n    defaultGun = `red`;\r\n  }\r\n  switch (defaultGun) {\r\n    case \"red\": {\r\n      Guns.PortalGun().useRedPortalGun(source, itemStack);\r\n      break;\r\n    }\r\n    case \"blue\": {\r\n      Guns.PortalGun().useBluePortalGun(source);\r\n      break;\r\n    }\r\n  }\r\n});\r\n\r\nsystem.runInterval(() => {\r\n  world.getAllPlayers().forEach((player) => {\r\n    let playerTpHolder = (player.getDynamicProperty(\"playerTpHolder\") as number) || 0;\r\n    player.dimension.getEntities({ maxDistance: 2, location: player.location }).forEach((entity) => {\r\n      if (playerTpHolder == 0) {\r\n        switch (entity.typeId) {\r\n          case \"keyyard:portal_red\": {\r\n            teleportToLinkedPortal(player, entity, \"keyyard:portal_blue\");\r\n            break;\r\n          }\r\n          case \"keyyard:portal_blue\": {\r\n            teleportToLinkedPortal(player, entity, \"keyyard:portal_red\");\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      if (playerTpHolder === 6) {\r\n        player.playSound(\"mob.endermen.portal\");\r\n      }\r\n      if (playerTpHolder > 0 && playerTpHolder <= 60) {\r\n        player.setDynamicProperty(\"playerTpHolder\", playerTpHolder + 1);\r\n      }\r\n      if (playerTpHolder > 60) {\r\n        player.setDynamicProperty(\"playerTpHolder\", 0);\r\n      }\r\n    });\r\n  });\r\n}, 1);\r\n","import { Entity, ItemStack, world, system, Player } from \"@minecraft/server\";\r\nimport { Vector3Utils } from \"@minecraft/math\";\r\n\r\nexport abstract class Guns {\r\n  static PortalGun() {\r\n    return new PortalGunScript();\r\n  }\r\n}\r\n\r\nclass PortalGunScript extends Guns {\r\n  async usePortalGun(source: Player, color: \"red\" | \"blue\") {\r\n    const portalType = color === \"red\" ? \"keyyard:portal_red\" : \"keyyard:portal_blue\";\r\n    const particleType =\r\n      color === \"red\" ? \"minecraft:stalactite_lava_drip_particle\" : \"minecraft:stalactite_water_drip_particle\";\r\n    source.dimension.playSound(\"cake.add_candle\", source.location);\r\n    source.dimension.spawnParticle(\r\n      \"keyyard:portal_gun_shoot\",\r\n      Vector3Utils.add(\r\n        source.getHeadLocation(),\r\n        Vector3Utils.multiply(source.getViewDirection(), { x: 1, y: 1.5, z: 1.5 })\r\n      )\r\n    );\r\n    const result = source.getBlockFromViewDirection({ maxDistance: 100 });\r\n    if (!result) return;\r\n    const target = result.block;\r\n    const distance = Vector3Utils.distance(source.location, target);\r\n    system.run(() => {\r\n      if (!source.isValid()) return;\r\n      const steps = distance * 2;\r\n      for (let i = 0; i <= steps; i++) {\r\n        const t = i / steps;\r\n        const point = Vector3Utils.lerp(source.getHeadLocation(), target, t);\r\n        source.dimension.spawnParticle(particleType, point);\r\n      }\r\n    });\r\n    await system.waitTicks(Math.ceil(distance * 0.1));\r\n    switch (color) {\r\n      case \"red\":\r\n      case \"blue\":\r\n        source.dimension.getEntities({ type: portalType }).forEach((entity) => entity.remove());\r\n    }\r\n\r\n    const { x, y, z } = target.location;\r\n    if (source.getViewDirection().y > 0.5 || source.getViewDirection().y < -0.5) {\r\n      //eslint-disable-next-line minecraft-linting/avoid-unnecessary-command\r\n      source.runCommand(`/summon ${portalType} ${x} ${y} ${z} facing ${source.nameTag} keyyard:lays`);\r\n    } else {\r\n      //eslint-disable-next-line minecraft-linting/avoid-unnecessary-command\r\n      source.runCommand(`/summon ${portalType} ${x} ${y} ${z} facing ${source.nameTag}`);\r\n    }\r\n\r\n    let defaultGun = source.getDynamicProperty(`defaultGun`) as string;\r\n    switch (portalType) {\r\n      case `keyyard:portal_blue`:\r\n        source.dimension.spawnParticle(`keyyard:portal_summon_blue`, target.location);\r\n        source.setDynamicProperty(`defaultGun`, `red`);\r\n        break;\r\n      case `keyyard:portal_red`:\r\n        source.dimension.spawnParticle(`keyyard:portal_summon_red`, target.location);\r\n        source.setDynamicProperty(`defaultGun`, `blue`);\r\n        break;\r\n    }\r\n  }\r\n\r\n  async useBluePortalGun(source: Player) {\r\n    await this.usePortalGun(source, \"blue\");\r\n  }\r\n\r\n  async useRedPortalGun(source: Player, itemStack: ItemStack) {\r\n    await this.usePortalGun(source, \"red\");\r\n  }\r\n}\r\n",null,null,"import { Player, system } from \"@minecraft/server\";\r\n\r\nfunction teleportToLinkedPortal(player: Player, portalEntity: any, targetPortalType: any) {\r\n  portalEntity.dimension.getEntities({ location: portalEntity.location }).forEach((linkedEntity: any) => {\r\n    if (linkedEntity.typeId === targetPortalType) {\r\n      // eslint-disable-next-line minecraft-linting/avoid-unnecessary-command\r\n      player.runCommand(\"/camera @s fade time 0.5 1 0.5\");\r\n      player.runCommand(\"/gamerule sendcommandfeedback false\");\r\n\r\n      system.runTimeout(() => {\r\n        const { x, y, z } = linkedEntity.location;\r\n        player.setDynamicProperty(\"playerTpHolder\", 1);\r\n        player.teleport({ x, y: y + 1, z });\r\n      }, 20);\r\n    }\r\n  });\r\n}\r\n\r\nexport { teleportToLinkedPortal };\r\n"],"mappings":"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","names":["Player","system","world","system","system","world","Player"],"file":"../scripts/main.js"}